<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Setup · Flujo Creativo</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Oswald:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --beige:#D9D9D9;
      --tile:#ECEBE8;
      --black:#000000;
      --white:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,sans-serif;
      color:var(--black);
      background:var(--beige);
      -webkit-font-smoothing:antialiased;
    }
    .wrap{max-width:1080px;margin:0 auto;padding:32px 20px 80px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px}
    .brand{font-family:"Oswald",sans-serif;letter-spacing:.5px;font-size:22px;text-transform:uppercase}

    /* Tabs */
    .tabs{display:flex;gap:6px;justify-content:center;margin-bottom:32px;border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:2px}
    .tab{background:transparent;border:none;padding:10px 20px;font-size:15px;cursor:pointer;color:var(--black);font-weight:600}
    .tab:hover{background:rgba(0,0,0,.05)}
    .tab.active{background:var(--black);color:var(--white)}

    /* Panels */
    .content{display:none}
    .content.active{display:block}

    /* Card */
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.15));
      border:1px solid rgba(0,0,0,.12);
      padding:40px 32px;margin-bottom:20px
    }
    h1{font-family:"Oswald",sans-serif;font-weight:600;font-size:36px;line-height:1.1;margin:0 0 12px}
    h2{font-family:"Oswald",sans-serif;font-weight:600;font-size:24px;margin:28px 0 12px}
    h3{font-size:17px;font-weight:700;margin:20px 0 8px}
    p{line-height:1.6;margin:0 0 16px}

    /* Steps (accordion simple) */
    details.step{background:var(--tile);border:1px solid rgba(0,0,0,.18);margin-bottom:12px}
    details.step>summary{
      list-style:none;padding:16px 20px;cursor:pointer;display:flex;align-items:center;gap:12px;font-weight:700;font-size:16px
    }
    details.step[open]>summary{background:rgba(0,0,0,.04)}
    details.step>summary::-webkit-details-marker{display:none}
    .step-body{padding:0 20px 20px;border-top:1px solid rgba(0,0,0,.08)}

    .option{background:rgba(255,255,255,.4);border:1px solid rgba(0,0,0,.12);padding:18px;margin:16px 0}
    .option h4{margin:0 0 8px;font-size:16px}

    table{width:100%;border-collapse:collapse;margin:16px 0;font-size:14px}
    th,td{border:1px solid rgba(0,0,0,.15);padding:10px 12px;text-align:left}
    th{background:rgba(0,0,0,.06);font-weight:600}
    code{background:rgba(0,0,0,.08);padding:2px 6px;font-family:ui-monospace,monospace;font-size:13px}

    /* Form */
    .form-group{margin:20px 0}
    .form-group label{display:block;font-weight:700;margin-bottom:8px;font-size:15px}
    .form-group input[type="text"]{width:100%;padding:12px;border:1px solid rgba(0,0,0,.2);background:var(--white);font-size:14px;font-family:inherit}
    .form-group input[type="text"]:focus{outline:2px solid var(--black);outline-offset:2px}
    .hint{font-size:13px;margin-top:6px;color:#555}

    .toggle{display:flex;align-items:center;gap:12px;margin:16px 0;cursor:pointer}
    .toggle input[type="checkbox"]{width:18px;height:18px;cursor:pointer}

    /* Collapsible helper */
    .collapsible{color:var(--black);text-decoration:underline;cursor:pointer;font-size:14px;margin:12px 0;display:inline-block;font-weight:700}
    .collapsible-content{display:none;margin-top:12px}
    .collapsible-content.open{display:block}

    /* Buttons */
    .btn{background:var(--black);color:var(--white);border:none;padding:12px 24px;font-size:14px;cursor:pointer;display:inline-block;text-decoration:none;margin-top:16px}
    .btn:hover{opacity:.9}
    .btn-secondary{background:var(--tile);color:var(--black);border:1px solid rgba(0,0,0,.3)}

    /* FAQ accordions */
    details.faq{border-bottom:1px solid rgba(0,0,0,.08);padding:12px 0}
    details.faq:last-child{border:none}
    details.faq>summary{list-style:none;cursor:pointer;font-weight:700;font-size:16px}
    details.faq>summary::-webkit-details-marker{display:none}
    details.faq[open]>summary{opacity:.9}

    /* Account (placeholder) */
    .account-info{background:rgba(255,255,255,.3);border:1px solid rgba(0,0,0,.12);padding:20px}
    .info-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid rgba(0,0,0,.08)}
    .info-row:last-child{border:none}
    .info-label{font-weight:700}
    .info-value{color:#333}

    /* Footer */
    .meta{display:flex;justify-content:space-between;gap:12px;margin-top:20px;font-size:12px;color:#000}
    .help-bubble{background:var(--tile);border:1px solid rgba(0,0,0,.2);padding:16px;margin-top:8px}
    a{color:var(--black);text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Flujo Creativo</div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="start">Empieza aquí</button>
      <button class="tab" data-tab="setup">Setup</button>
      <button class="tab" data-tab="help">Ayuda</button>
      <button class="tab" data-tab="account">Cuenta</button>
    </nav>

    <!-- TAB 1: Empieza aquí -->
    <section class="content active" id="start">
      <div class="card">
        <h1>Planifica tu feed con un Grid en Notion</h1>
        <p style="font-size:17px;margin-bottom:28px">
          En pocos pasos tendrás una galería estilo Instagram que se actualiza automáticamente.
        </p>

        <h2>Pasos</h2>

        <details class="step" open>
          <summary>1) Prepara tu base en Notion</summary>
          <div class="step-body">
            <div class="option">
              <h4>Opción recomendada — Usar el template</h4>
              <p>Duplica el template para obtener una base lista con ejemplo.</p>
              <a class="btn" href="https://www.notion.so/Flujo-Creativo-Instagram-Grid-28673654be06818d8561f78d28ed6f3b" target="_blank" rel="noopener">Duplicar template →</a>
            </div>

            <div class="option">
              <h4>Opción avanzada — Tu propia base</h4>
              <p>Asegura estas propiedades (nombres exactos):</p>
              <table>
                <thead><tr><th>Propiedad</th><th>Tipo</th><th>Uso</th></tr></thead>
                <tbody>
                  <tr><td><code>Name</code></td><td>Text</td><td>Título al pasar sobre imagen</td></tr>
                  <tr><td><code>Publish Date</code></td><td>Date</td><td>Orden del grid</td></tr>
                  <tr><td><code>Attachment</code></td><td>Files & Media</td><td>Imágenes/videos base</td></tr>
                  <tr><td><code>Image Source</code></td><td>Select</td><td>Attachment / Link / Canva Design (Pro)</td></tr>
                  <tr><td><code>Link</code></td><td>Text</td><td>URL externa de imagen/video (Pro)</td></tr>
                  <tr><td><code>Canva Link</code></td><td>URL</td><td>Enlace “Embed” de Canva (Pro)</td></tr>
                </tbody>
              </table>
              <p class="hint">Usuarios Basic: pueden usar solo <strong>Attachment</strong>.</p>
            </div>
          </div>
        </details>

        <details class="step">
          <summary>2) Crea una Integración de Notion</summary>
          <div class="step-body">
            <ol style="line-height:1.8">
              <li>Abre <a href="https://www.notion.so/my-integrations" target="_blank" rel="noopener">Notion Integrations</a></li>
              <li>New Integration → Internal</li>
              <li>Copia el <strong>Integration Token</strong></li>
              <li>En tu base, menú ••• → <strong>Connect to</strong> → elige la integración</li>
            </ol>
            <label class="toggle"><input type="checkbox" id="step2-done"> He conectado la integración a mi base</label>
          </div>
        </details>

        <details class="step">
          <summary>3) Genera y embebe tu widget</summary>
          <div class="step-body">
            <ol style="line-height:1.8">
              <li>Ve a la pestaña <strong>Setup</strong> (arriba)</li>
              <li>Pega tu <strong>Integration Token</strong> y la <strong>URL de la base</strong></li>
              <li>Genera la URL del widget</li>
              <li>En Notion: escribe <code>/embed</code> y pega esa URL</li>
            </ol>
            <p class="hint"><strong>Tip:</strong> abre la base en vista de página completa y copia la URL de la barra del navegador (no vistas vinculadas).</p>
          </div>
        </details>

        <div class="meta">
          <div>© 2025 Flujo Creativo · Sistema Notion Grid</div>
          <div>
            ¿Necesitas ayuda?
            <a href="#" id="help-toggle">abrir</a>
            <div class="help-bubble" id="help-bubble" style="display:none">
              Escríbeme a <a href="mailto:emiliagrijalvao@gmail.com">emiliagrijalvao@gmail.com</a>. <br/>
              Revisa también la pestaña <strong>Ayuda</strong>.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TAB 2: Setup -->
    <section class="content" id="setup">
      <div class="card">
        <h1>Widget Setup</h1>

        <div class="form-group">
          <label>Notion Integration Token</label>
          <input type="text" id="token-input" placeholder="secret_xxxxx..." />
          <span class="collapsible" data-target="token-instructions">+ Instrucciones</span>
          <div class="collapsible-content" id="token-instructions">
            <ol style="font-size:14px;line-height:1.7;margin-top:12px">
              <li>Ve a <a href="https://www.notion.so/my-integrations" target="_blank" rel="noopener">Notion Integrations</a></li>
              <li>New integration → Internal → copia el token</li>
              <li>Conecta esa integración a tu base (••• → Connect to)</li>
              <li>Pega aquí el token</li>
            </ol>
          </div>
        </div>

        <div class="form-group">
          <label>Database URL</label>
          <input type="text" id="db-input" placeholder="https://www.notion.so/tu-workspace/..." />
          <p class="hint">Debe ser la URL de la <strong>base fuente</strong> en vista de página completa, no una vista vinculada.</p>
          <span class="collapsible" data-target="db-instructions">+ Cómo copiar el enlace correcto</span>
          <div class="collapsible-content" id="db-instructions">
            <ol style="font-size:14px;line-height:1.7;margin-top:12px">
              <li>Abre la base en página completa</li>
              <li>••• → Copy Link (o copia de la barra del navegador)</li>
            </ol>
          </div>
        </div>

        <button class="btn" id="generate-widget">Generar Widget →</button>

        <div id="widget-result" style="display:none;margin-top:24px;padding:20px;background:rgba(0,128,0,.08);border:1px solid rgba(0,128,0,.3)">
          <h3>URL generada</h3>
          <p>Incrusta esta URL en Notion con <code>/embed</code>:</p>
          <code id="widget-url" style="display:block;padding:12px;background:var(--white);margin:8px 0;word-break:break-all">https://...</code>
          <button class="btn btn-secondary" id="copy-widget">Copiar URL</button>
        </div>
      </div>
    </section>

    <!-- TAB 3: Ayuda -->
    <section class="content" id="help">
      <div class="card">
        <h1>Preguntas frecuentes</h1>

        <!-- DUDAS MÁS COMUNES (accordions) -->
        <details class="faq">
          <summary>¿Cómo empiezo con el widget?</summary>
          <div>
            <p>Sigue la guía en <a href="#" data-goto="start">Empieza aquí</a>. Luego, en <a href="#" data-goto="setup">Setup</a> genera tu widget con tu token de Notion y la URL de tu base. Toma ~3 minutos.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Cómo configuro correctamente mi base de Notion?</summary>
          <div>
            <p>Incluye estas columnas obligatorias con nombres exactos: <strong>Name (Text)</strong>, <strong>Publish Date (Date)</strong>, <strong>Attachment (Files & Media)</strong>. Para Pro: <strong>Image Source (Select)</strong>, <strong>Link (Text)</strong>, <strong>Canva Link (URL)</strong>. Puedes usar el <a href="https://www.notion.so/Flujo-Creativo-Instagram-Grid-28673654be06818d8561f78d28ed6f3b" target="_blank" rel="noopener">template</a>.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Por qué dice que no pudo acceder a mi base?</summary>
          <div>
            <p>Suele ser una URL incorrecta. Abre la base en <strong>página completa</strong> y copia la URL del navegador. Asegúrate de usar la <strong>base fuente</strong>, no una vista vinculada.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Puedo usar mi base existente?</summary>
          <div>
            <p>Sí. Solo respeta los nombres exactos de columnas que usa el widget. Mantén tus demás columnas como están.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Puedo renombrar las columnas?</summary>
          <div>
            <p>No. Las columnas especiales deben mantener su nombre exacto para que el widget funcione.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Puedo usar este widget para múltiples clientes?</summary>
          <div>
            <p>Sí. Crea una base por cliente (puedes reutilizar el mismo token conectándolo a cada base). Cada cliente tendrá su propia URL de widget.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Cómo incrusto diseños de Canva? (Pro)</summary>
          <div>
            <p>Selecciona “Canva Design” en <em>Image Source</em> y pega el enlace <em>Embed</em> de Canva en <em>Canva Link</em>. No uses la URL del navegador.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Cómo agrego videos? (Pro)</summary>
          <div>
            <p>Sube el video a <em>Attachment</em> o pega un enlace en <em>Link</em>, y selecciona el tipo correcto en <em>Image Source</em>.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Cómo elimino el widget?</summary>
          <div>
            <p>Elimina el bloque de embed en Notion. Para removerlo por completo, desde tu área de cuenta podrás borrar la instancia (cuando habilitemos esa acción).</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Cuál es la diferencia entre Basic y Pro?</summary>
          <div>
            <p><strong>Basic:</strong> Imágenes desde <em>Attachment</em> (hasta 12).<br>
               <strong>Pro:</strong> Fuentes múltiples (Attachment/Link/Canva), grid clicable, carrusel multi-imagen y pin de posts.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Cómo actualizo a Pro?</summary>
          <div>
            <p>Compra en la tienda de Shopify con el mismo correo. Tus widgets se actualizarán automáticamente al refrescar.</p>
          </div>
        </details>

        <details class="faq">
          <summary>¿Ofrecen reembolsos?</summary>
          <div>
            <p>No manejo reembolsos. Puedes probar la versión básica gratis antes de actualizar a Pro. Si algo no funciona, escríbeme y te ayudo.</p>
          </div>
        </details>
      </div>
    </section>

    <!-- TAB 4: Cuenta (placeholder) -->
    <section class="content" id="account">
      <div class="card">
        <h1>Cuenta</h1>
        <div class="account-info">
          <div class="info-row"><span class="info-label">Email</span><span class="info-value" id="user-email">—</span></div>
          <div class="info-row"><span class="info-label">Nombre</span><span class="info-value" id="user-name">—</span></div>
          <div class="info-row"><span class="info-label">Tipo de cuenta</span><span class="info-value" id="account-type">Basic</span></div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Tabs
    document.querySelectorAll('.tab').forEach(tab=>{
      tab.addEventListener('click',()=>{
        const target=tab.dataset.tab;
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
        document.getElementById(target).classList.add('active');
      });
    });

    // Collapsible helpers
    document.querySelectorAll('.collapsible').forEach(trigger=>{
      trigger.addEventListener('click',()=>{
        const content=document.getElementById(trigger.dataset.target);
        content.classList.toggle('open');
        trigger.textContent=content.classList.contains('open')
          ? '− Ocultar'
          : '+ Instrucciones';
      });
    });

    // Internal goto links
    document.querySelectorAll('[data-goto]').forEach(link=>{
      link.addEventListener('click',(e)=>{
        e.preventDefault();
        const target=link.dataset.goto;
        document.querySelector(`[data-tab="${target}"]`).click();
      });
    });

    // Help bubble
    const helpToggle=document.getElementById('help-toggle');
    const helpBubble=document.getElementById('help-bubble');
    if(helpToggle){helpToggle.addEventListener('click',(e)=>{e.preventDefault();helpBubble.style.display=helpBubble.style.display==='none'?'block':'none';});}

    // Generate widget (mock client-side; tu backend debe responder en /api/widgets/create)
    const genBtn=document.getElementById('generate-widget');
    const out=document.getElementById('widget-result');
    const outUrl=document.getElementById('widget-url');
    const copyBtn=document.getElementById('copy-widget');

    if(genBtn){
      genBtn.addEventListener('click', async ()=>{
        const token=document.getElementById('token-input').value.trim();
        const db=document.getElementById('db-input').value.trim();
        const ok=document.getElementById('step2-done').checked;

        if(!token||!db){alert('Completa Token y Database URL.');return;}
        if(!ok){alert('Marca que conectaste la integración a la base.');return;}

        // Lado cliente “mock”: genera una URL estable con tu dominio final
        const wid=Math.random().toString(36).slice(2,8);
        const widget=`https://notion-grid-mini.vercel.app/preview?id=${wid}&db=${encodeURIComponent(db)}`;

        outUrl.textContent=widget;
        out.style.display='block';
        out.scrollIntoView({behavior:'smooth'});
      });
    }

    if(copyBtn){
      copyBtn.addEventListener('click',async ()=>{
        await navigator.clipboard.writeText(outUrl.textContent);
        copyBtn.textContent='Copiado ✓';
        setTimeout(()=>copyBtn.textContent='Copiar URL',1200);
      });
    }
  </script>
</body>
</html>

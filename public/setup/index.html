<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Setup · Flujo Creativo</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Oswald:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --beige:#D9D9D9;
      --tile:#ECEBE8;
      --black:#000000;
      --white:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,sans-serif;
      color:var(--black);
      background:var(--beige);
      -webkit-font-smoothing:antialiased;
    }
    .wrap{max-width:1080px;margin:0 auto;padding:32px 20px 80px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;}
    .brand{font-family:"Oswald",sans-serif;letter-spacing:.5px;font-size:22px;text-transform:uppercase;}

    /* Tabs */
    .tabs{display:flex;gap:6px;justify-content:center;margin-bottom:32px;border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:2px;}
    .tab{background:transparent;border:none;padding:10px 20px;font-size:15px;cursor:pointer;color:var(--black);font-weight:500;transition:.15s;}
    .tab:hover{background:rgba(0,0,0,.05)}
    .tab.active{background:var(--black);color:var(--white);}

    /* Content */
    .content{display:none}
    .content.active{display:block}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.15));border:1px solid rgba(0,0,0,.12);padding:40px 32px;margin-bottom:20px;}

    h1{font-family:"Oswald",sans-serif;font-weight:600;font-size:36px;line-height:1.1;margin:0 0 12px;}
    h2{font-family:"Oswald",sans-serif;font-weight:600;font-size:24px;margin:28px 0 12px;}
    h3{font-size:17px;font-weight:600;margin:20px 0 8px;}
    p{line-height:1.6;margin:0 0 16px}

    /* Steps */
    .steps{margin-top:24px}
    .step{background:var(--tile);border:1px solid rgba(0,0,0,.18);margin-bottom:12px;}
    .step-header{padding:16px 20px;cursor:pointer;display:flex;align-items:center;gap:12px;font-weight:600;font-size:16px;}
    .step-header:hover{background:rgba(0,0,0,.03)}
    .step-body{display:none;padding:0 20px 20px;border-top:1px solid rgba(0,0,0,.08);}
    .step.open .step-body{display:block}
    .step.open .step-header{background:rgba(0,0,0,.04)}

    /* Options */
    .option{background:rgba(255,255,255,.4);border:1px solid rgba(0,0,0,.12);padding:18px;margin:16px 0;}
    .option h4{margin:0 0 8px;font-size:16px}

    /* Table */
    table{width:100%;border-collapse:collapse;margin:16px 0;font-size:14px;}
    th,td{border:1px solid rgba(0,0,0,.15);padding:10px 12px;text-align:left;}
    th{background:rgba(0,0,0,.06);font-weight:600;}
    code{background:rgba(0,0,0,.08);padding:2px 6px;font-family:ui-monospace,monospace;font-size:13px;}

    /* Form */
    .form-group{margin:20px 0}
    .form-group label{display:block;font-weight:600;margin-bottom:8px;font-size:15px;}
    .form-group input[type="text"]{width:100%;padding:12px;border:1px solid rgba(0,0,0,.2);background:var(--white);font-size:14px;font-family:inherit;}
    .form-group input[type="text"]:focus{outline:2px solid var(--black);outline-offset:2px;}

    .toggle{display:flex;align-items:center;gap:12px;margin:16px 0;cursor:pointer;}
    .toggle input[type="checkbox"]{width:20px;height:20px;cursor:pointer;}

    .collapsible{color:var(--black);text-decoration:underline;cursor:pointer;font-size:14px;margin:12px 0;display:inline-block;font-weight:600;}
    .collapsible-content{display:none;margin-top:12px;}
    .collapsible-content.open{display:block}

    /* Buttons */
    .btn{background:var(--black);color:var(--white);border:none;padding:12px 24px;font-size:14px;cursor:pointer;display:inline-block;text-decoration:none;margin-top:16px;}
    .btn:hover{opacity:.9}
    .btn-secondary{background:var(--tile);color:var(--black);border:1px solid rgba(0,0,0,.3);}

    /* Links */
    a{color:var(--black);text-decoration:underline}
    a:hover{opacity:.7}

    /* FAQ */
    .faq-item{margin-bottom:24px;padding-bottom:20px;border-bottom:1px solid rgba(0,0,0,.08);}
    .faq-item:last-child{border:none}
    .faq-item h3{font-size:16px;margin:0 0 8px;}

    /* Account */
    .account-section{margin-bottom:32px}
    .account-info{background:rgba(255,255,255,.3);border:1px solid rgba(0,0,0,.12);padding:20px;}
    .info-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid rgba(0,0,0,.08);}
    .info-row:last-child{border:none}
    .info-label{font-weight:600}
    .info-value{color:#333}
    .license-list{margin-top:16px}
    .license-item{background:rgba(255,255,255,.25);border:1px solid rgba(0,0,0,.1);padding:12px 16px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;font-size:14px;}
    .license-key{font-family:ui-monospace,monospace;font-size:12px;color:#555;}
    .license-date{font-size:13px;color:#666;}
    .upgrade-badge{display:inline-block;background:#000;color:#fff;padding:4px 10px;font-size:12px;font-weight:600;margin-left:8px;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Flujo Creativo</div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="start">Empieza aquí</button>
      <button class="tab" data-tab="setup">Setup</button>
      <button class="tab" data-tab="help">Help</button>
      <button class="tab" data-tab="account">Account</button>
    </nav>

    <!-- TAB 1: Empieza aquí -->
    <div class="content active" id="start">
      <div class="card">
        <!-- CAMBIO 1: Título y subtítulo -->
        <h1>Tu feed merece más que una hoja de cálculo ✨</h1>
        <p style="font-size:17px;margin-bottom:28px">
          Visualiza tu contenido como realmente se verá en Instagram. Tu Notion + un grid visual de Instagram = planificación sin estrés, porque tu tiempo y tu creatividad valen oro.
        </p>

        <h2>Sigue estos pasos:</h2>
        <div class="steps">
          <!-- Step 1 -->
          <div class="step open">
            <div class="step-header">
              <span>1. Setup tu template en Notion</span>
            </div>
            <div class="step-body">
              <p>Primero, vamos a configurar la estructura de tu contenido</p>

              <div class="option">
                <h4>OPCIÓN 1: Usa nuestro template (recomendado)</h4>
                <p>Duplica el template para obtener una base de datos lista con imágenes de ejemplo en tu Notion. Recomendamos usar este template primero para asegurarte de que todo funcione correctamente antes de cambiar a tu propio sistema.</p>
                <a href="https://www.notion.so/Flujo-Creativo-Instagram-Grid-28673654be06818d8561f78d28ed6f3b" target="_blank" class="btn">Duplicar template →</a>
              </div>

              <div class="option">
                <h4>OPCIÓN 2: Crea tu propia base de datos</h4>
                <p>Si prefieres empezar desde cero o modificar una base existente, asegúrate de que tenga estas propiedades exactas:</p>
                <table>
                  <thead>
                    <tr><th>Propiedad</th><th>Tipo</th><th>Propósito</th></tr>
                  </thead>
                  <tbody>
                    <tr><td><code>Name</code></td><td>Text</td><td>Se muestra al pasar sobre imágenes</td></tr>
                    <tr><td><code>Publish Date</code></td><td>Date</td><td>Controla el orden de tu galería</td></tr>
                    <tr><td><code>Attachment</code></td><td>Files & Media</td><td>Imágenes o videos de tu galería</td></tr>
                    <tr><td><code>*Image Source</code></td><td>Select</td><td>Attachment / Link / Canva Design (Pro)</td></tr>
                    <tr><td><code>*Link</code></td><td>Text</td><td>URL de imagen/video externo (Pro)</td></tr>
                    <tr><td><code>*Canva Link</code></td><td>URL</td><td>Embed de Canva (Pro)</td></tr>
                  </tbody>
                </table>
                <p style="font-size:13px;color:#555">* Requeridas solo si usarás funciones Pro.</p>
              </div>
            </div>
          </div>

          <!-- Step 2 -->
          <div class="step">
            <div class="step-header">
              <span>2. Conecta la integración (Notion)</span>
            </div>
            <div class="step-body">
              <p>Conecta tu base de datos a nuestro widget</p>
              <h3>HAGÁMOSLO:</h3>
              <ol style="line-height:1.8">
                <li>Ve a la <a href="https://www.notion.so/my-integrations" target="_blank">página de Integraciones de Notion</a> y crea una nueva integración.</li>
                <li>Vuelve a tu base → menú <strong>•••</strong> → <strong>Connect to</strong> → elige tu integración.</li>
              </ol>

              <div class="toggle">
                <input type="checkbox" id="step2-done">
                <label for="step2-done">Sí, he completado los pasos anteriores</label>
              </div>
            </div>
          </div>

          <!-- Step 3 -->
          <div class="step">
            <div class="step-header">
              <span>3. Embed el Notion widget</span>
            </div>
            <div class="step-body">
              <p>Agrega la galería a tu página de Notion</p>
              <h3>INCRUSTA EL WIDGET:</h3>
              <ol style="line-height:1.8">
                <li>Ve a la pestaña <a href="#" data-goto="setup">Setup</a> y genera tu URL de widget.</li>
                <li>En Notion, escribe <code>/embed</code> y pega la URL.</li>
                <li>Repite el proceso para el Bio (opcional) si pegaste la URL de su base en Setup.</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB 2: Setup -->
    <div class="content" id="setup">
      <div class="card">
        <h1>Widget Setup</h1>

        <div class="form-group">
          <label>Notion Integration Token</label>
          <input type="text" id="token-input" placeholder="secret_xxxxx..." />
          <span class="collapsible" data-target="token-instructions">+ Instrucciones</span>
          <div class="collapsible-content" id="token-instructions">
            <ol style="font-size:14px;line-height:1.7;margin-top:12px">
              <li>Ve a <a href="https://www.notion.so/my-integrations" target="_blank">Notion Integrations</a> y crea una integración.</li>
              <li>Copia el Integration Token y pégalo aquí.</li>
              <li>Reutilízalo para futuros widgets si deseas.</li>
            </ol>
          </div>
        </div>

        <div class="form-group">
          <label>Conecta la integración con la base de datos</label>
          <ol style="font-size:14px;line-height:1.7">
            <li>Abre tu base de datos en Notion. Menú <strong>•••</strong> → <strong>Connect to</strong> → tu integración.</li>
          </ol>
          <div class="toggle">
            <input type="checkbox" id="integration-done">
            <label for="integration-done">Sí, he conectado la integración a la base</label>
          </div>
        </div>

        <div class="form-group">
          <label>Database URL (Grid)</label>
          <input type="text" id="db-input" placeholder="https://www.notion.so/workspace/..." />
          <p style="font-size:13px;margin-top:6px;color:#555">Copia el enlace de la base de datos en vista de página completa.</p>
          <span class="collapsible" data-target="db-instructions">+ Mostrar instrucciones</span>
          <div class="collapsible-content" id="db-instructions">
            <ol style="font-size:14px;line-height:1.7;margin-top:12px">
              <li>Abre la base (no una vista vinculada) en Notion.</li>
              <li>Usa <strong>••• → Copy link</strong> o copia desde la barra del navegador.</li>
            </ol>
          </div>
        </div>

        <!-- CAMBIO 2: BIO (opcional) -->
        <div class="form-group">
          <label>Bio (opcional) — URL de la base de datos</label>
          <input type="text" id="bio-input" placeholder="https://www.notion.so/workspace/..." />
          <span class="collapsible" data-target="bio-instructions">+ Instrucciones para Bio</span>
          <div class="collapsible-content" id="bio-instructions">
            <ol style="font-size:14px;line-height:1.7;margin-top:12px">
              <li>Si usas un Bio independiente, abre esa base en Notion y copia su enlace.</li>
              <li>Asegúrate de conectar la <strong>misma integración</strong> a esta base (menú <strong>••• → Connect to</strong>).</li>
              <li>Pega la URL aquí para generar una <strong>segunda URL</strong> de embed exclusiva de tu Bio.</li>
              <li>En Notion, podrás hacer <code>/embed</code> y pegar esta URL para mostrar el Bio.</li>
            </ol>
          </div>
        </div>

        <button class="btn" id="generate-widget">Generar Widget →</button>

        <div id="widget-result" style="display:none;margin-top:24px;padding:20px;background:rgba(0,255,0,.08);border:1px solid rgba(0,128,0,.25)">
          <h3>¡Widget generado!</h3>
          <p>URL para incrustar en Notion (Grid):</p>
          <code id="widget-url" style="display:block;padding:12px;background:var(--white);margin:8px 0">https://…</code>
          <button class="btn-secondary btn" onclick="navigator.clipboard.writeText(document.getElementById('widget-url').textContent)">Copiar URL</button>
        </div>

        <!-- Resultado de Bio -->
        <div id="bio-result" style="display:none;margin-top:16px;padding:20px;background:rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.2)">
          <h3>Bio (opcional)</h3>
          <p>URL para incrustar en Notion (Bio):</p>
          <code id="bio-url" style="display:block;padding:12px;background:var(--white);margin:8px 0">https://…</code>
          <button class="btn-secondary btn" onclick="navigator.clipboard.writeText(document.getElementById('bio-url').textContent)">Copiar URL</button>
        </div>
      </div>
    </div>

    <!-- TAB 3: Help (dejamos tu contenido actual) -->
    <div class="content" id="help">
      <div class="card">
        <h1>Preguntas Frecuentes</h1>
        <!-- Mantén aquí tu FAQ actual. (Sin cambios) -->
        <div class="faq-item">
          <h3>¿Cómo empiezo con el widget?</h3>
          <p>Puedes seguir la guía en <a href="#" data-goto="start">Empieza aquí</a> y luego ir a <a href="#" data-goto="setup">Setup</a> para generar tu URL de widget con tu token y la URL de la base.</p>
        </div>
        <!-- ... (tu resto de preguntas existentes) ... -->
      </div>
    </div>

    <!-- TAB 4: Account (sin cambios) -->
    <div class="content" id="account">
      <div class="card">
        <h1>Información Personal</h1>
        <div class="account-info">
          <div class="info-row"><span class="info-label">Email</span><span class="info-value" id="user-email">emiliagrijalvao@gmail.com</span></div>
          <div class="info-row"><span class="info-label">Name</span><span class="info-value"><span id="user-name">Cuenta del cliente</span></span></div>
          <div class="info-row"><span class="info-label">Account Type</span><span class="info-value"><span id="account-type">Basic Account</span><a href="#" class="upgrade-badge">Upgrade to Pro</a></span></div>
        </div>
        <div class="account-section">
          <h2>Licencias</h2>
          <div class="license-list" id="license-list">
            <div class="license-item"><div><div style="font-weight:600">Sin licencias</div><div class="license-key">—</div></div><div class="license-date">—</div></div>
          </div>
        </div>
        <div class="account-section">
          <h2>Tus Widgets</h2>
          <div id="widgets-empty" style="font-size:14px;color:#555">Aún no has creado ningún widget.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tabs
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const target = tab.dataset.tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.getElementById(target).classList.add('active');
      });
    });

    // Acordeones (steps)
    document.querySelectorAll('.step-header').forEach(header => {
      header.addEventListener('click', () => {
        header.parentElement.classList.toggle('open');
      });
    });

    // Collapsibles
    document.querySelectorAll('.collapsible').forEach(trigger => {
      trigger.addEventListener('click', () => {
        const targetId = trigger.dataset.target;
        const content = document.getElementById(targetId);
        content.classList.toggle('open');
        trigger.textContent = content.classList.contains('open') 
          ? '- Ocultar instrucciones' 
          : '+ Mostrar instrucciones';
      });
    });

    // Navegación interna
    document.querySelectorAll('[data-goto]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = link.dataset.goto;
        document.querySelector(`[data-tab="${target}"]`).click();
      });
    });

    // GENERAR WIDGET (usa tu backend ya instalado)
    document.getElementById('generate-widget').addEventListener('click', async () => {
      const token = document.getElementById('token-input')?.value?.trim();     // no se guarda por ahora
      const gridDbUrl = document.getElementById('db-input')?.value?.trim();
      const bioDbUrl = document.getElementById('bio-input')?.value?.trim() || null;
      const integrationDone = document.getElementById('integration-done')?.checked;

      if (!gridDbUrl) { alert('Pega la URL de tu base de datos de Notion (Grid)'); return; }
      if (!integrationDone) { alert('Marca que conectaste la integración a la base.'); return; }

      try {
        const r = await fetch('/api/widgets/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: 'cliente@example.com',
            gridDbUrl,
            bioDbUrl: bioDbUrl || undefined,
            plan: (new URLSearchParams(location.search).get('plan') === 'pro') ? 'pro' : 'basic'
          })
        });

        const data = await r.json();
        if (!r.ok || !data.ok) throw new Error(data.error || 'Error al crear el widget');

        // Mostrar URLs
        document.getElementById('widget-url').textContent = data.gridEmbedUrl;
        document.getElementById('widget-result').style.display = 'block';

        const bioBlock = document.getElementById('bio-result');
        if (data.bioEmbedUrl && bioBlock) {
          document.getElementById('bio-url').textContent = data.bioEmbedUrl;
          bioBlock.style.display = 'block';
        } else if (bioBlock) {
          bioBlock.style.display = 'none';
        }

        document.getElementById('widget-result').scrollIntoView({ behavior: 'smooth' });
      } catch (err) {
        alert('No se pudo generar el widget: ' + err.message);
      }
    });

    // Simulación de plan Pro vía ?plan=pro
    const urlParams = new URLSearchParams(window.location.search);
    const plan = urlParams.get('plan');
    if (plan === 'pro') {
      document.getElementById('account-type').textContent = 'Pro Account';
      const up = document.querySelector('.upgrade-badge');
      if (up) up.style.display = 'none';
    }
  </script>
</body>
</html>

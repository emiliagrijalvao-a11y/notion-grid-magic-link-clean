<script>
async function loadAccountData() {
  const token = new URLSearchParams(window.location.search).get('token');
  if (!token) return; // si no hay token, deja el estado vacío

  try {
    const r = await fetch(`/api/user/account?token=${encodeURIComponent(token)}`);
    const user = await r.json();
    if (!r.ok) throw new Error(user.error || 'Error');

    // pinta email/nombre/plan
    document.getElementById('user-email').textContent = user.email || '';
    document.getElementById('user-name').textContent  = user.name || '';
    document.getElementById('account-type').textContent = (user.accountType || 'basic').toUpperCase() + ' Account';

    // licencias
    const licList = document.getElementById('license-list');
    licList.innerHTML = '';
    (user.licenses || []).forEach(l => {
      const div = document.createElement('div');
      div.className = 'license-item';
      div.innerHTML = `
        <div>
          <div style="font-weight:600">${l.type} License Key</div>
          <div class="license-key">${l.key}</div>
        </div>
        <div class="license-date">${l.date || ''}</div>`;
      licList.appendChild(div);
    });
  } catch (e) {
    console.error(e);
  }
}

// carga automática
loadAccountData();
</script>
